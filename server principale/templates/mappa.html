<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mappa EcoCharge</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <h2>Mappa Colonnine</h2>
    <div id="map" style="height:600px;"></div>

    <script>
        // Crea la mappa centrata su Milano
        const map = L.map('map').setView([45.4642, 9.1900], 13);

        // Aggiunge le tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Chiamata all'API REST per ottenere i dati
        fetch('/api/mappa')
            .then(response => response.json())
            .then(data => {
                data.forEach(c => {
                    const color = c.stato === 'libera' ? 'green' : 'red';
                    const marker = L.circleMarker([c.latitudine, c.longitudine], {
                        radius: 8,
                        fillColor: color,
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);

                    marker.bindPopup(`
                        <b>${c.indirizzo}</b><br>
                        Potenza: ${c.potenza_kw} kW<br>
                        Stato: ${c.stato}<br>
                        ${c.stato==='libera'?`<a href="/prenota/${c.id_colonnina}">Prenota</a>`:''}
                    `);
                });
            });
    </script>
</body>
</html>